<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>100-Item Long Quiz</title>
<style>
  @media (max-width: 600px) {
    body { font-size: 15px; }
    .wrap { padding: 16px; }
    .qtext { font-size: 16px; }
    .choice { padding: 10px; }
    button { width: 100%; } /* easier tap area */
    .footer { flex-direction: column; align-items: stretch; }
  }

  :root{
    --bg:#0f172a; --card:#111827; --muted:#64748b; --text:#e5e7eb; --accent:#22c55e; --warn:#f59e0b; --bad:#ef4444; --good:#10b981;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial,sans-serif;background:linear-gradient(180deg,#0b1022,#0f172a);color:var(--text)}
  .wrap{max-width:960px;margin:0 auto;padding:24px}
  .card{background:linear-gradient(180deg,#0b1220,#0d1426);border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  header{display:flex;justify-content:space-between;gap:12px;align-items:center;padding:16px 20px;border-bottom:1px solid #1f2937}
  header .meta{display:flex;gap:16px;flex-wrap:wrap}
  .pill{padding:6px 10px;border-radius:999px;background:#111827;color:#cbd5e1;border:1px solid #1f2937;font-size:12px}
  .content{padding:20px}
  h1{margin:0;font-size:18px;color:#e2e8f0}
  h2{margin:0 0 8px 0;font-size:16px;color:#e2e8f0}
  .name-stage, .quiz-stage, .result-stage{display:none}
  .active{display:block}
  .field{display:flex;gap:12px;flex-wrap:wrap;margin:12px 0}
  input[type="text"]{padding:12px 14px;border-radius:10px;border:1px solid #334155;background:#0b1220;color:#e5e7eb;flex:1;min-width:260px}
  button{padding:12px 16px;border:1px solid #263042;border-radius:12px;background:#0b1326;color:#e5e7eb;cursor:pointer}
  button.primary{background:linear-gradient(180deg,#126d3a,#0d5a30);border-color:#144b2e}
  button:hover{filter:brightness(1.08)}
  .qtext{font-size:18px;line-height:1.5;margin-bottom:16px}
  .choices{display:grid;gap:10px}
  .choice{display:flex;gap:10px;align-items:flex-start;background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:12px}
  .choice input{margin-top:3px}
  .footer{display:flex;justify-content:space-between;align-items:center;gap:12px;margin-top:16px}
  .progress{height:8px;background:#0f172a;border:1px solid #1f2937;border-radius:999px;overflow:hidden}
  .bar{height:100%;background:linear-gradient(90deg,#22c55e,#16a34a)}
  .toast{position:fixed;right:18px;bottom:max(18px, env(safe-area-inset-bottom));background:#111827;border:1px solid #334155;border-radius:12px;padding:12px 14px;color:#e5e7eb;opacity:0;transform:translateY(8px);transition:.25s;z-index:9999}
  .toast.show{opacity:1;transform:translateY(0)}
  .muted{color:#94a3b8}
  .small{font-size:12px}
  code.inline{background:#0b1220;border:1px solid #1f2937;border-radius:6px;padding:2px 6px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <header>
      <h1>100-Item Long Quiz</h1>
      <div class="meta">
        <span class="pill" id="who">Name: —</span>
        <span class="pill" id="sectionPill">Section: —</span>
        <span class="pill" id="timer">Time: 60:00</span>
        <span class="pill" id="counter">Q: — / 100</span>
        <span class="pill" id="penalties">Tab switches: 0</span>
        <span class="pill" id="deduct">Penalty: 0</span>
      </div>
    </header>
    <div class="content">
      <!-- Stage: Name -->
      <section class="name-stage active" id="stageName">
        <h2>Enter your information to begin</h2>
        <div class="field">
          <input type="text" id="studentName" placeholder="Full name (e.g., Juan Dela Cruz)" />
          <input type="text" id="studentSection" placeholder="Year and Section (e.g., BS Agri 2A)" />
          <button class="primary" id="btnStart">Start Quiz</button>
        </div>
        <p class="muted small">Once you start, you’ll have <b>1 hour</b>. Questions are randomized. Switching tabs deducts <b>10 points</b> each time.</p>
      </section>

      <!-- Stage: Quiz -->
      <section class="quiz-stage" id="stageQuiz">
        <div class="progress" aria-hidden="true"><div class="bar" id="bar" style="width:0%"></div></div>
        <p class="qtext" id="qtext"></p>
        <div class="choices" id="choices"></div>
        <div class="footer">
          <button id="btnPrev">Review</button>
          <div>
            <button id="btnNext" class="primary">Next</button>
          </div>
        </div>
      </section>

      <!-- Stage: Results -->
      <section class="result-stage" id="stageResult">
        <h2>Submission Complete ✅</h2>
        <p><b id="resName"></b> (<span id="resSection"></span>), here are your results:</p>
        <p>Raw Score: <b id="resRaw"></b> / 100<br>
           Penalties (tab switches × 10): <b id="resPenalty"></b><br>
           Final Score: <b id="resFinal"></b> / 100</p>
        <p class="muted small">Your answers have been recorded. Please wait for your instructor’s feedback.</p>
      </section>
    </div>
  </div>
</div>

<div class="toast" id="toast">Please choose an answer before proceeding.</div>

<!-- Firebase (v10 modules) -->
<script type="module">
  /* ==========================
     🔧 FIREBASE SETUP
     - Enable Firestore
     - Enable Anonymous Auth (Console → Authentication)
  ========================== */
  const firebaseConfig = {
    apiKey: "AIzaSyB-idZOq8h9sVttNdzXE2t8FMoYI_snq7g",
    authDomain: "kuya-quiz-100.firebaseapp.com",
    projectId: "kuya-quiz-100",
    storageBucket: "kuya-quiz-100.appspot.com",
    messagingSenderId: "74623975270",
    appId: "1:74623975270:web:dec2b21dbee017292952a7"
  };

  const canInitFirebase = Object.values(firebaseConfig).every(v => typeof v === 'string' && !v.includes('REPLACE_ME'));

  let app, db, addDoc, collection, serverTimestamp, getAuth, signInAnonymously, auth;
  if (canInitFirebase) {
    const firebase = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js");
    const firestore = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js");
    const authmod   = await import("https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js");
    app = firebase.initializeApp(firebaseConfig);
    db  = firestore.getFirestore(app);
    addDoc = firestore.addDoc;
    collection = firestore.collection;
    serverTimestamp = firestore.serverTimestamp;
    getAuth = authmod.getAuth;
    signInAnonymously = authmod.signInAnonymously;
    auth = getAuth(app);
  }

  /* ==========================
     QUESTIONS + ANSWER KEY
     (Original order preserved in `id`)
  ========================== */
  const QUESTIONS = [
    {id:1,q:"What does the term Genetically Modified Organism (GMO) refer to?",A:"An organism bred through traditional crossbreeding",B:"An organism with a naturally occurring genetic mutation",C:"An organism whose genetic material has been altered using biotechnology",D:"An organism created through natural selection",ans:"C"},
    {id:2,q:"Which of the following techniques is commonly used to produce GMOs?",A:"Cloning by mitosis",B:"Recombinant DNA technology",C:"Selective breeding",D:"Spontaneous mutation",ans:"B"},
    {id:3,q:"The main goal of creating genetically modified crops is to:",A:"Make them look more colorful",B:"Improve yield, resistance, and nutritional value",C:"Reduce their lifespan",D:"Eliminate all natural traits",ans:"B"},
    {id:4,q:"Which of the following best defines transgenic organisms?",A:"Organisms with duplicated chromosomes",B:"Organisms with artificially induced mutations",C:"Organisms that carry genes from another species",D:"Organisms that evolved faster than others",ans:"C"},
    {id:5,q:"The gene inserted into Bt corn comes from:",A:"A virus",B:"Another corn variety",C:"A bacterium (Bacillus thuringiensis)",D:"A fungus",ans:"C"},
    {id:6,q:"Which of the following is a direct impact of GMOs on food quantity?",A:"Increased food prices",B:"Higher crop yield per hectare",C:"Reduced farm labor",D:"Slower maturity rate",ans:"B"},
    {id:7,q:"A major benefit of GM crops for farmers is:",A:"The ability to use fewer pesticides",B:"Reduced need for chemical pesticides",C:"Greater dependence on herbicides",D:"Inability to replant seeds",ans:"B"},
    {id:8,q:"Which GMO crop was designed to produce higher Vitamin A content?",A:"Bt cotton",B:"StarLink corn",C:"Golden Rice",D:"Roundup Ready soybean",ans:"C"},
    {id:9,q:"What is the most common concern about the environmental impact of GMOs?",A:"They improve soil fertility",B:"They help biodiversity",C:"They may harm non-target organisms and biodiversity",D:"They reduce water pollution",ans:"C"},
    {id:10,q:"How can GMOs impact human health positively?",A:"By increasing the amount of fat in food",B:"By causing allergies",C:"By enhancing the nutritional quality of food",D:"By reducing taste",ans:"C"},
    {id:11,q:"A potential negative health effect of GMOs is:",A:"Improved immunity",B:"Allergenic reactions in sensitive individuals",C:"Increased metabolism",D:"Longer lifespan",ans:"B"},
    {id:12,q:"The StarLink corn controversy involved which main issue?",A:"Low yield",B:"Drought resistance",C:"Allergenicity in human food supply",D:"Pest control failure",ans:"C"},
    {id:13,q:"The Monarch butterfly controversy was primarily about:",A:"Bt corn killing all butterflies directly",B:"Potential harm to Monarch larvae feeding on milkweed near Bt corn fields",C:"Cross-pollination increasing butterfly numbers",D:"Loss of butterfly colors",ans:"B"},
    {id:14,q:"Which controversy involved a genetically modified potato found to have harmful effects in rats?",A:"Monarch butterfly controversy",B:"Poisonous potato controversy",C:"StarLink corn controversy",D:"Mexican corn gene escape controversy",ans:"B"},
    {id:15,q:"The Mexican corn gene escape controversy refers to:",A:"Pollen from GM corn mixing with native varieties",B:"Genetic contamination of native maize varieties in Mexico",C:"Bt corn becoming invasive",D:"Corn spreading to Asia",ans:"B"},
    {id:16,q:"Banning or moratoriums on GMOs are usually based on:",A:"High production costs",B:"Uncertainty about health and environmental safety",C:"Low farmer interest",D:"Lack of government funding",ans:"B"},
    {id:17,q:"Labeling laws for GM foods exist mainly to:",A:"Discourage consumers from buying GMOs",B:"Help farmers manage crops",C:"Allow consumers to make informed choices",D:"Control prices",ans:"C"},
    {id:18,q:"Intellectual property issues in biotechnology often involve:",A:"The right to free seeds",B:"The ownership of farmlands",C:"Patenting of genes and modified organisms",D:"Fertilizer costs",ans:"C"},
    {id:19,q:"Germline therapy differs from somatic therapy because:",A:"It treats only adults",B:"It affects only one tissue",C:"It alters heritable DNA changes in reproductive cells",D:"It uses only chemical drugs",ans:"C"},
    {id:20,q:"Gene therapy primarily aims to:",A:"Replace faulty genes to cure diseases",B:"Correct or replace defective genes",C:"Clone patients",D:"Create superhumans",ans:"B"},
    {id:21,q:"One ethical concern about gene therapy is:",A:"It might reduce mutation rates",B:"It may increase biodiversity",C:"It could be used for enhancement, not just treatment",D:"It has no risks",ans:"C"},
    {id:22,q:"Which of the following best describes cloning?",A:"Reproduction through random mutation",B:"Mixing genes from different species",C:"Producing genetically identical copies of an organism",D:"Artificial selection",ans:"C"},
    {id:23,q:"What was Dolly the sheep a milestone for?",A:"Gene editing in crops",B:"Stem cell research",C:"First successful cloning of an adult mammal",D:"Transgenic animal patenting",ans:"C"},
    {id:24,q:"In the Philippines, BioN is known for:",A:"Producing fertilizers",B:"A government-funded biotechnology program for research and product development",C:"A multinational seed company",D:"A pesticide initiative",ans:"B"},
    {id:25,q:"Agrivam and EM vs. IMO in the Philippines relate to:",A:"Crop rotation methods",B:"Plant breeding programs",C:"Local biotechnology and microbial inoculants used in agriculture",D:"Vaccine manufacturing",ans:"C"},
    {id:26,q:"Which international agreement regulates the transboundary movement of living modified organisms (LMOs)?",A:"Montreal Protocol",B:"Cartagena Protocol on Biosafety",C:"Kyoto Protocol",D:"Rio Declaration",ans:"B"},
    {id:27,q:"Which organization provides global guidelines for the labeling of GM food products?",A:"World Health Organization (WHO)",B:"Codex Alimentarius Commission",C:"World Trade Organization (WTO)",D:"International Seed Federation",ans:"B"},
    {id:28,q:"The economic advantage of planting GM crops for farmers is primarily due to:",A:"Increased dependence on seed companies",B:"Reduced government control",C:"Decreased pesticide and herbicide costs",D:"Elimination of weeds",ans:"C"},
    {id:29,q:"Critics argue that patenting genetically modified seeds:",A:"Encourages biodiversity",B:"Reduces consumer awareness",C:"Limits farmers’ rights to save and reuse seeds",D:"Makes farming more sustainable",ans:"C"},
    {id:30,q:"What is a key environmental risk of GMOs spreading beyond intended areas?",A:"Genetic drift",B:"Seed storage",C:"Gene flow to wild relatives",D:"Artificial selection",ans:"C"},
    {id:31,q:"Which best describes a terminator gene in biotechnology?",A:"A gene that increases plant resistance",B:"A gene that replicates faster than normal",C:"A gene designed to prevent plants from producing viable seeds",D:"A gene that causes mutation",ans:"C"},
    {id:32,q:"Which of the following is not a potential benefit of GM foods?",A:"Longer shelf life",B:"Enhanced nutritional content",C:"Spontaneous pest mutations",D:"Drought resistance",ans:"C"},
    {id:33,q:"The main concern with herbicide-tolerant GM crops is that:",A:"They reduce herbicide use completely",B:"They may promote the evolution of “superweeds”",C:"They improve soil fertility",D:"They are unable to survive in the wild",ans:"B"},
    {id:34,q:"Which gene-editing technology allows for precise modification of DNA without introducing foreign genes?",A:"RNA interference",B:"CRISPR-Cas9",C:"Somatic hybridization",D:"Gene cloning",ans:"B"},
    {id:35,q:"Which of the following best represents a societal issue regarding GMOs?",A:"Gene flow",B:"Mutation rate",C:"Consumer acceptance and trust",D:"Soil degradation",ans:"C"},
    {id:36,q:"The precautionary principle in biotechnology means:",A:"Approving all GMOs unless proven harmful",B:"Allowing open trials without review",C:"Acting to prevent potential harm even without full scientific certainty",D:"Releasing GMOs after one successful trial",ans:"C"},
    {id:37,q:"Which best explains the “gene escape” problem?",A:"GM crops cannot reproduce",B:"Transgenes spread unintentionally to non-GM plants",C:"Seeds fail to germinate in the soil",D:"Farmers illegally plant GM seeds",ans:"B"},
    {id:38,q:"The major ethical issue in germline modification is that:",A:"It can’t be done in animals",B:"The changes are heritable and affect future generations",C:"It only treats visible traits",D:"It cannot be reversed",ans:"B"},
    {id:39,q:"A major difference between gene therapy and genetic enhancement is:",A:"Therapy focuses on correcting disease, enhancement aims at improving normal traits",B:"Therapy is heritable; enhancement is not",C:"Enhancement fixes genetic disorders",D:"Therapy uses cloning technology",ans:"A"},
    {id:40,q:"The StarLink corn controversy emphasized what regulatory weakness?",A:"Overuse of herbicides",B:"Lack of separation between human and animal food chains",C:"Poor labeling in consumer markets",D:"Inefficient crop monitoring",ans:"B"},
    {id:41,q:"Which of the following was an outcome of the Monarch butterfly controversy?",A:"Bt corn was banned globally",B:"Milkweed was eradicated",C:"Triggered further research on non-target effects of GM crops",D:"Bt corn was proven safe for all insects",ans:"C"},
    {id:42,q:"One scientific response to concerns about GM crop safety is:",A:"Ignoring public opinion",B:"Testing only in the lab",C:"Conducting long-term field and feeding trials",D:"Reducing sample sizes",ans:"C"},
    {id:43,q:"What was the main claim of the poisonous potato controversy?",A:"GM potatoes improved rat health",B:"GM potatoes expressing lectin caused negative effects in rats",C:"Rats preferred GM potatoes",D:"Potatoes became inedible",ans:"B"},
    {id:44,q:"What is one possible positive impact of GMOs on the environment?",A:"Creation of superweeds",B:"Decreased biodiversity",C:"Reduction in pesticide usage",D:"Soil contamination",ans:"C"},
    {id:45,q:"Which of the following ethical issues is most associated with cloning humans?",A:"Reduced reproduction",B:"Genetic variation increase",C:"Identity, individuality, and moral status of clones",D:"Economic inequality",ans:"C"},
    {id:46,q:"Why do some scientists support GMOs in developing countries?",A:"They ensure dependence on foreign companies",B:"They can enhance food security and crop resilience",C:"They eliminate natural crops",D:"They replace local practices entirely",ans:"B"},
    {id:47,q:"A reason why some countries impose GMO labeling requirements is:",A:"To reduce research costs",B:"To promote industry profits",C:"To protect consumer autonomy and choice",D:"To discourage local farming",ans:"C"},
    {id:48,q:"What economic disadvantage can result from GMO adoption?",A:"Increased global biodiversity",B:"Lower trade opportunities",C:"Dependence on patented seeds and higher input costs",D:"Reduction of crop yields",ans:"C"},
    {id:49,q:"The Philippines’ BioN network mainly serves which function?",A:"Farmer seed distribution",B:"Crop export regulation",C:"Coordination and promotion of biotechnology research",D:"Seed patent approval",ans:"C"},
    {id:50,q:"The use of Effective Microorganisms (EM) versus Indigenous Microorganisms (IMO) focuses on:",A:"Chemical fertilizer efficiency",B:"Gene therapy in humans",C:"Soil health improvement through microbial biotechnology",D:"Animal breeding",ans:"C"},
    {id:51,q:"Which of the following is an example of a first-generation GMO crop?",A:"Golden Rice",B:"Bt cotton",C:"Drought-tolerant maize",D:"Iron-fortified rice",ans:"B"},
    {id:52,q:"What distinguishes second-generation GMOs from first-generation ones?",A:"They are less stable",B:"They focus on nutritional or quality improvements",C:"They are only ornamental",D:"They contain no foreign DNA",ans:"B"},
    {id:53,q:"Golden Rice was developed to address which public-health issue?",A:"Iron deficiency",B:"Vitamin A deficiency",C:"Zinc deficiency",D:"Obesity",ans:"B"},
    {id:54,q:"The term biotechnology broadly refers to:",A:"Only genetic engineering of plants",B:"The use of living organisms or systems to make products and solve problems",C:"The study of bacteria only",D:"The cloning of animals",ans:"B"},
    {id:55,q:"Which method can help prevent cross-pollination between GM and non-GM crops?",A:"Mixing seeds before planting",B:"Using identical crop varieties",C:"Maintaining isolation distances or buffer zones",D:"Applying chemical barriers",ans:"C"},
    {id:56,q:"Why do developing countries face difficulty regulating GMOs?",A:"They have too many scientists",B:"They lack consumer demand",C:"They often have limited biosafety infrastructure and expertise",D:"They ban all biotechnology",ans:"C"},
    {id:57,q:"Which principle underlies international biosafety laws for GMOs?",A:"Trade over safety",B:"Speed of approval",C:"Risk assessment and informed consent",D:"Market dominance",ans:"C"},
    {id:58,q:"Which global issue does gene patenting raise?",A:"Encouraging biodiversity",B:"Limiting education",C:"Ownership and access to genetic resources",D:"Soil conservation",ans:"C"},
    {id:59,q:"In gene therapy, a vector is used to:",A:"Block DNA translation",B:"Detect mutations",C:"Deliver genetic material into cells",D:"Clone new tissues",ans:"C"},
    {id:60,q:"What is one risk of using viral vectors in gene therapy?",A:"They fail to integrate",B:"They may trigger immune responses or insertional mutations",C:"They are always inactive",D:"They multiply uncontrollably",ans:"B"},
    {id:61,q:"Why is germline gene editing more controversial than somatic editing?",A:"It’s less effective",B:"It cannot treat diseases",C:"Changes are heritable and may affect future generations",D:"It’s cheaper and faster",ans:"C"},
    {id:62,q:"Which of the following describes pharming?",A:"Planting GMO crops",B:"Animal cloning",C:"Using transgenic animals or plants to produce pharmaceuticals",D:"Food irradiation",ans:"C"},
    {id:63,q:"A key argument for cloning endangered species is that it:",A:"Guarantees extinction",B:"Helps preserve biodiversity",C:"Decreases population size",D:"Increases mutation rates",ans:"B"},
    {id:64,q:"Critics argue that cloning animals for food may:",A:"Improve milk quality",B:"Be cost-effective",C:"Raise animal welfare and ethical concerns",D:"Eliminate genetic diseases",ans:"C"},
    {id:65,q:"What do EM and IMO technologies have in common?",A:"They are chemical fertilizers",B:"They utilize beneficial microorganisms for soil improvement",C:"They are synthetic herbicides",D:"They depend on pesticides",ans:"B"},
    {id:66,q:"The Philippines’ National Biosafety Committee (NBC) is responsible for:",A:"Exporting GMO crops",B:"Evaluating and approving GMO applications",C:"Setting fertilizer prices",D:"Conducting field plowing",ans:"B"},
    {id:67,q:"One argument against banning GMOs outright is that:",A:"GMOs have no risks",B:"It violates farmer rights",C:"Responsible regulation allows benefits while managing risks",D:"GMOs cannot spread",ans:"C"},
    {id:68,q:"What does bioethics primarily address in biotechnology?",A:"Crop yield optimization",B:"Moral and social implications of biological research",C:"Plant breeding techniques",D:"Soil testing methods",ans:"B"},
    {id:69,q:"Which is a legitimate biosafety concern in GM food production?",A:"Overpricing of seeds",B:"Reduction in marketing",C:"Accidental mixing of GM and non-GM food supplies",D:"Longer shelf life",ans:"C"},
    {id:70,q:"What was the main lesson from the Mexican corn gene escape case?",A:"GMOs cannot survive in Mexico",B:"Corn plants cannot hybridize",C:"Gene flow monitoring is essential for biodiversity protection",D:"Bt corn is harmless to all species",ans:"C"},
    {id:71,q:"A major difference between EM and IMO technologies is that:",A:"EM uses locally collected microbes, IMO uses commercial ones",B:"Both are identical",C:"EM uses imported cultures, IMO uses indigenous microorganisms",D:"Both rely on chemical fertilizers",ans:"C"},
    {id:72,q:"Why are international trade disputes common over GMOs?",A:"Uniform acceptance worldwide",B:"Different nations have different GMO regulations and labeling laws",C:"All nations allow unrestricted GMO trade",D:"GMOs do not affect trade",ans:"B"},
    {id:73,q:"Which statement best describes biopiracy?",A:"Legal patent sharing",B:"Cross-breeding native plants",C:"Unauthorized commercial use of biological resources from developing nations",D:"Theft of laboratory equipment",ans:"C"},
    {id:74,q:"Which of the following most closely reflects the goals of sustainable biotechnology?",A:"Maximizing profit regardless of impact",B:"Using biotechnology for short-term yield boosts",C:"Balancing productivity with ecological and ethical responsibility",D:"Eliminating traditional agriculture",ans:"C"},
    {id:75,q:"What can be a long-term ecological consequence of uncontrolled GMO cultivation?",A:"Soil fertility improvement",B:"Loss of genetic diversity and emergence of resistant pests",C:"Decrease in global temperature",D:"Improved water quality",ans:"B"},
    {id:76,q:"Which best describes the relationship between GMOs and biodiversity?",A:"GMOs always increase biodiversity",B:"GMOs have no relationship with biodiversity",C:"Improper GMO management can reduce biodiversity through gene flow",D:"GMOs automatically restore natural species",ans:"C"},
    {id:77,q:"Which approach ensures the safe introduction of GM crops into an ecosystem?",A:"Immediate large-scale planting",B:"Elimination of non-GM varieties",C:"Stepwise release with risk assessment and environmental monitoring",D:"Ignoring ecological effects",ans:"C"},
    {id:78,q:"What is the primary scientific basis of public opposition to GMOs?",A:"GMOs always cause disease",B:"GMOs are not tested at all",C:"Concerns about long-term ecological and health effects",D:"GMOs are unnatural",ans:"C"},
    {id:79,q:"Which ethical argument supports limited use of gene editing in humans?",A:"It could make humans identical",B:"It can treat serious diseases without altering normal traits",C:"It should replace traditional medicine",D:"It eliminates genetic diversity",ans:"B"},
    {id:80,q:"Why is the regulation of GMOs considered a multidisciplinary issue?",A:"It requires only farmers’ opinions",B:"It involves science, ethics, law, and economics",C:"It is purely political",D:"It excludes consumers",ans:"B"},
    {id:81,q:"Which example shows biotechnology improving environmental sustainability?",A:"Use of more pesticides",B:"Deforestation for GM crop expansion",C:"Bioremediation using engineered microbes",D:"Monocropping of GM soybeans",ans:"C"},
    {id:82,q:"What is a major limitation of current GM technology?",A:"Inability to alter genes",B:"Unintended genetic effects and off-target mutations",C:"Reduced plant survival",D:"Lack of global research",ans:"B"},
    {id:83,q:"The ethical debate on human cloning mainly centers on:",A:"The speed of cloning",B:"Its cost to scientists",C:"The moral status, identity, and rights of cloned individuals",D:"Increased biodiversity",ans:"C"},
    {id:84,q:"Why might farmers in developing countries hesitate to adopt GMOs?",A:"They are anti-technology",B:"High seed prices and dependency on multinational corporations",C:"GMOs have no market value",D:"GMOs always fail in tropical climates",ans:"B"},
    {id:85,q:"What is the core principle of the Cartagena Protocol on Biosafety?",A:"Mandatory use of GMOs in agriculture",B:"Free trade of transgenic crops",C:"Protection of biodiversity from potential GMO risks",D:"Industrial ownership of genetic materials",ans:"C"},
    {id:86,q:"In the Philippines, which agency primarily regulates the field testing of GM crops?",A:"Department of Tourism (DOT)",B:"Department of Agriculture (DA)",C:"Department of Health (DOH)",D:"Department of Trade and Industry (DTI)",ans:"B"},
    {id:87,q:"Which is not an argument used by opponents of GMO labeling?",A:"Labeling increases consumer awareness",B:"Labeling could cause unnecessary fear among consumers",C:"It increases food costs",D:"It stigmatizes GM products",ans:"B"},
    {id:88,q:"The phrase “playing God” often appears in biotechnology debates. It refers to:",A:"The efficiency of genetic engineering",B:"The moral concern of altering life’s natural design",C:"A new genetic technique",D:"Government regulation",ans:"B"},
    {id:89,q:"What was one lesson from the poisonous potato controversy?",A:"All GMOs are dangerous",B:"GM potatoes are superior in nutrition",C:"Proper experimental design and peer review are vital before releasing claims",D:"Bt toxins are universally safe",ans:"C"},
    {id:90,q:"How do GM crops contribute to climate change adaptation?",A:"They trap carbon dioxide",B:"They create new ecosystems",C:"They can be engineered for drought and heat resistance",D:"They replace forests",ans:"C"},
    {id:91,q:"What distinguishes BioN from commercial biotech firms in the Philippines?",A:"It is a private seed company",B:"It is a national collaborative network promoting research and education",C:"It manufactures only fertilizers",D:"It imports GM seeds",ans:"B"},
    {id:92,q:"What is one ethical justification for GMO research?",A:"It guarantees corporate profit",B:"It ensures human superiority",C:"It can help reduce malnutrition and hunger",D:"It replaces all organic farming",ans:"C"},
    {id:93,q:"What is the main reason labeling of GM food is required in many countries?",A:"To promote GMO exports",B:"To increase profit margins",C:"To ensure transparency and consumer choice",D:"To hide allergens",ans:"C"},
    {id:94,q:"Which statement is true about the EM vs. IMO approaches?",A:"Both destroy soil microbes",B:"EM uses standardized mixed cultures; IMO relies on local microbes",C:"EM requires chemicals to activate",D:"IMO reduces soil fertility",ans:"B"},
    {id:95,q:"Which of the following can be an unintended ecological consequence of Bt crops?",A:"Increased soil fertility",B:"Attraction of more pollinators",C:"Resistance development in target insects",D:"Enhanced biodiversity",ans:"C"},
    {id:96,q:"What is one reason that intellectual property rights (IPR) are controversial in biotechnology?",A:"They promote scientific collaboration",B:"They guarantee fair access to farmers",C:"They can restrict access to life-saving technologies",D:"They prevent competition",ans:"C"},
    {id:97,q:"Which is an example of biotechnology misuse?",A:"Production of drought-tolerant crops",B:"Vaccine development",C:"Creation of biological weapons",D:"Environmental restoration",ans:"C"},
    {id:98,q:"Why are public-private partnerships important in advancing biotechnology in the Philippines?",A:"They restrict innovation",B:"They promote monopolies",C:"They combine government oversight with private innovation",D:"They replace universities",ans:"C"},
    {id:99,q:"Which of the following is a potential social impact of widespread GMO adoption?",A:"Decreased farm employment",B:"Increased soil fertility",C:"Farmer dependency on patented technologies",D:"Improved biodiversity",ans:"C"},
    {id:100,q:"The ultimate goal of ethical biotechnology practice is to:",A:"Maximize economic profit",B:"Eliminate all natural crops",C:"Improve human welfare while protecting the environment and respecting rights",D:"Replace traditional agriculture",ans:"C"},
  ];

  /* ==========================
     QUIZ LOGIC
  ========================== */
  const el = id => document.getElementById(id);
  const stageName = el('stageName');
  const stageQuiz = el('stageQuiz');
  const stageResult = el('stageResult');
  const btnStart = el('btnStart');
  const inputName = el('studentName');
  const inputSection = el('studentSection');
  const qtext = el('qtext');
  const choicesEl = el('choices');
  const btnPrev = el('btnPrev');
  const btnNext = el('btnNext');
  const counter = el('counter');
  const who = el('who');
  const sectionPill = el('sectionPill');
  const timer = el('timer');
  const penaltiesBadge = el('penalties');
  const deductBadge = el('deduct');
  const bar = el('bar');
  const toast = el('toast');

  const resName = el('resName');
  const resSection = el('resSection');
  const resRaw = el('resRaw');
  const resPenalty = el('resPenalty');
  const resFinal = el('resFinal');

  // Shuffle util
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  // Build working list: shuffle per session, but keep original `id`.
  const working = shuffle(QUESTIONS.map(x => ({...x})));
  const N = working.length;

  // State
  let idx = 0;
  let answers = Array(N).fill(null); // 'A'|'B'|'C'|'D'|null
  let started = false;
  let secondsLeft = 60*60; // 1 hour
  let timerHandle = null;
  let tabSwitches = 0;

  function showToast(msg){
    toast.textContent = msg;
    toast.classList.add('show');
    setTimeout(()=>toast.classList.remove('show'), 1800);
  }

  function render(){
    counter.textContent = `Q: ${idx+1} / ${N}`;
    const q = working[idx];
    qtext.textContent = q.q; // no numbering visible during quiz
    choicesEl.innerHTML = '';
    ['A','B','C','D'].forEach(letter=>{
      const wrap = document.createElement('label');
      wrap.className='choice';
      wrap.innerHTML = `
        <input type="radio" name="opt" value="${letter}">
        <div><b>${letter}.</b> ${q[letter]}</div>
      `;
      choicesEl.appendChild(wrap);
    });
    // restore selection
    if(answers[idx]){
      const sel = choicesEl.querySelector(`input[value="${answers[idx]}"]`);
      if(sel) sel.checked = true;
    }
    // buttons
    btnPrev.disabled = (idx===0);
    btnNext.textContent = (idx===N-1) ? 'Submit' : 'Next';
    // progress bar
    bar.style.width = `${((idx)/Math.max(1,(N-1)))*100}%`;
  }

  function getSelected(){
    const sel = choicesEl.querySelector('input[name="opt"]:checked');
    return sel ? sel.value : null;
  }

  function toQuiz(){
    stageName.classList.remove('active');
    stageQuiz.classList.add('active');
    started = true;
    render();
    startTimer();
  }

  function toResults(payload){
    stageQuiz.classList.remove('active');
    stageResult.classList.add('active');

    const {studentName,yearSection, rawScore, penalties, finalScore} = payload;
    resName.textContent = studentName;
    resSection.textContent = yearSection;
    resRaw.textContent = rawScore;
    resPenalty.textContent = penalties*10;
    resFinal.textContent = finalScore;
  }

  function computeAndSubmit(){
    // Build sheet from randomized order, then sort back by originalId
    let raw = 0;
    const sheetUnordered = working.map((q, i) => {
      const chosen = answers[i];
      if (chosen && chosen === q.ans) raw++;
      return {
        displayNo: i+1,           // position in randomized display
        originalId: q.id,         // original question number (1..100)
        text: q.q,
        A: q.A, B: q.B, C: q.C, D: q.D,
        correct: q.ans,
        chosen: chosen ?? null
      };
    });
    const orderedSheet = sheetUnordered.sort((a,b)=>a.originalId - b.originalId);

    const penalties = tabSwitches;
    const finalScore = Math.max(0, raw - penalties*10);

    const studentName = inputName.value.trim();
    const yearSection = inputSection.value.trim();

    const payload = {
      studentName,
      yearSection,
      rawScore: raw,
      penalties,
      finalScore,
      secondsRemaining: secondsLeft,
      submittedAt: new Date().toISOString()
    };

    (async ()=>{
      try{
        if (db && addDoc && collection){
          await addDoc(collection(db, "submissions"), {
            name: studentName,
            section: yearSection,
            rawScore: raw,
            penalties,
            finalScore,
            secondsRemaining: secondsLeft,
            sheet: orderedSheet,       // full detailed sheet saved for admin
            createdAt: serverTimestamp()
          });
        }
      }catch(err){
        console.warn("Firestore write failed:", err);
      }finally{
        toResults(payload);
      }
    })();
  }

  function next(){
    const sel = getSelected();
    if(!sel){
      showToast("Please choose an answer before proceeding.");
      return;
    }
    answers[idx] = sel;
    if(idx === N-1){
      clearInterval(timerHandle);
      computeAndSubmit();
    }else{
      idx++;
      render();
    }
  }

  function prev(){
    if(idx>0){
      const sel = getSelected();
      if(sel) answers[idx] = sel;
      idx--;
      render();
    }
  }

  function startTimer(){
    function fmt(s){
      const m = Math.floor(s/60), ss = s%60;
      return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
    }
    timer.textContent = `Time: ${fmt(secondsLeft)}`;
    timerHandle = setInterval(()=>{
      secondsLeft--;
      if(secondsLeft<=0){
        clearInterval(timerHandle);
        answers[idx] = getSelected() ?? answers[idx];
        computeAndSubmit();
      }else{
        timer.textContent = `Time: ${fmt(secondsLeft)}`;
      }
    },1000);
  }

  // Tab switch detection (cheating penalty)
  document.addEventListener('visibilitychange', ()=>{
    if (!started) return;
    if (document.hidden){
      tabSwitches++;
      penaltiesBadge.textContent = `Tab switches: ${tabSwitches}`;
      deductBadge.textContent = `Penalty: ${tabSwitches*10}`;
      showToast("Tab change detected: -10 points.");
    }
  });

  // Anonymous sign-in before starting
  async function ensureAnonAuth(){
    if (!auth) return; // in case Firebase failed to init
    try {
      if (!auth.currentUser) {
        await signInAnonymously(auth);
      }
      return true;
    } catch (e) {
      console.error("Anonymous Auth failed:", e);
      showToast("Cannot start: Auth is blocked. Please retry or contact your instructor.");
      return false;
    }
  }

  // UI events
  btnStart.addEventListener('click', async ()=>{
    const nm = inputName.value.trim();
    const sec = inputSection.value.trim();
    if(!nm || !sec){ showToast("Please enter your full name and section."); return; }

    // Sign-in anonymously (required by Firestore rules)
    const ok = await ensureAnonAuth();
    if (!ok) return;

    who.textContent = `Name: ${nm}`;
    sectionPill.textContent = `Section: ${sec}`;
    toQuiz();
  });
  inputName.addEventListener('keydown',(e)=>{ if(e.key==='Enter') btnStart.click(); });
  btnNext.addEventListener('click', next);
  btnPrev.addEventListener('click', prev);

  // Keyboard shortcuts
  document.addEventListener('keydown', (e)=>{
    if(!stageQuiz.classList.contains('active')) return;
    if(['1','2','3','4','a','b','c','d','A','B','C','D'].includes(e.key)){
      const map = { '1':'A','2':'B','3':'C','4':'D' };
      const v = map[e.key] || e.key.toUpperCase();
      const radio = choicesEl.querySelector(`input[value="${v}"]`);
      if(radio){ radio.checked = true; }
    } else if(e.key === 'ArrowRight'){ next(); }
      else if(e.key === 'ArrowLeft'){ prev(); }
  });
</script>
</body>
</html>
